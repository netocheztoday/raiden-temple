<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Raiden and the Wing Chun Temple</title>
<style>
  :root{ --frame-max: 960px; --pad: 10px; }
  html,body{margin:0;background:#000;color:#fff;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  #frame{max-width:var(--frame-max); margin:0 auto; padding:0 var(--pad);}
  #menu{display:flex;flex-direction:column;align-items:center;gap:14px;padding:16px 0;}
  #menu img{width:100%;height:auto;display:block;border-radius:8px}
  .btn{background:#111;border:2px solid #fff;color:#fff;border-radius:8px;padding:12px 22px;font-size:18px}
  .btn:active{transform:translateY(1px)}
  #wrap{position:relative}
  #cvs{display:none;width:100%;height:auto;background:#0b1622;image-rendering:pixelated;border-radius:12px}
  #hud{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.55);padding:6px 10px;border-radius:8px;
       font-family:monospace;font-size:14px;display:none}
  #tag{position:absolute;left:10px;top:10px;background:#0b0e12;color:#cfe1ff;
       padding:4px 8px;border-radius:10px;font:12px/1.2 monospace;opacity:.85;display:none}
  #controls{display:none;gap:10px;justify-content:space-between;margin:10px 0}
  .pad{flex:1;min-width:80px;height:64px;font-size:22px;border:2px solid #303a46;background:#141c26;color:#fff;border-radius:12px}
  .pad:active{filter:brightness(1.2)}
  #fade{position:absolute;inset:0;background:#000;opacity:0;pointer-events:none;transition:opacity .25s}
</style>
</head>
<body>
<div id="frame">
  <div id="menu">
    <img src="menu-title.png" alt="Raiden and the Wing Chun Temple">
    <button class="btn" onclick="startGame()">Play</button>
    <button class="btn" id="musicBtn" onclick="toggleMusic()">Music: On</button>
    <button class="btn" onclick="alert('Credits\\nMusic & Art: You\\nCode helper: ChatGPT')">Credits</button>
  </div>
  <div id="wrap">
    <canvas id="cvs" width="800" height="450"></canvas>
    <div id="hud">Stage: <span id="stageName">—</span></div>
    <div id="tag"></div>
    <div id="fade"></div>
  </div>
  <div id="controls">
    <button class="pad" ontouchstart="keys.left=1"  ontouchend="keys.left=0">◀</button>
    <button class="pad" ontouchstart="keys.right=1" ontouchend="keys.right=0">▶</button>
    <button class="pad" ontouchstart="keys.punch=1" ontouchend="keys.punch=0">J</button>
    <button class="pad" ontouchstart="keys.jump=1"  ontouchend="keys.jump=0">␣</button>
  </div>
</div>

<script>
/* ===== AUDIO ===== */
let musicOn = true, currentMusic = "menu";
const tracks = {};
["menu","crane","snake","tiger","gates","temple","victory","gameover","credits"].forEach(n=>{
  const a = new Audio(n + ".mp3");
  a.loop = (n!=="victory" && n!=="gameover");
  tracks[n] = a;
});
function stopAll(){ for(const a of Object.values(tracks)){ a.pause(); a.currentTime=0; } }
function playMusic(name){ if(!musicOn) return; stopAll(); currentMusic=name; tracks[name]?.play(); }
function toggleMusic(){
  musicOn = !musicOn;
  document.getElementById("musicBtn").textContent = "Music: " + (musicOn?"On":"Off");
  if(musicOn) playMusic(currentMusic); else stopAll();
}

/* ===== CANVAS / HELPERS ===== */
const cvs = document.getElementById("cvs");
const ctx = cvs.getContext("2d",{alpha:true});
ctx.imageSmoothingEnabled = false;
function loadImg(src){ const i=new Image(); i.src=src+"?v="+Date.now(); return i; }
function drawCover(img,dw,dh){
  const iw=img.naturalWidth, ih=img.naturalHeight; if(!iw||!ih) return;
  const r=Math.max(dw/iw,dh/ih), sw=Math.floor(dw/r), sh=Math.floor(dh/r);
  const sx=Math.floor((iw-sw)/2), sy=Math.floor((ih-sh)/2);
  ctx.drawImage(img,sx,sy,sw,sh,0,0,dw,dh);
}

/* ===== BACKGROUNDS ===== */
const BG = {
  room: loadImg("bg-room.png"),
  field: loadImg("bg-field.png"),
  crane: loadImg("bg-crane.png"),
  snake: loadImg("bg-snake.png"),
  tiger: loadImg("bg-tiger.png"),
  templegates: loadImg("bg-templegates.png"),
  temple: loadImg("bg-temple.png"),
};

/* ===== SPRITE ===== */
let spriteReady=false, FW=0, FH=0, COLS=3, ROWS=3;
const sprite=new Image();
sprite.src="raiden-sprites.png?v="+Date.now();
sprite.onload=()=>{ FW=sprite.naturalWidth/COLS; FH=sprite.naturalHeight/ROWS; spriteReady=true; };

/* ===== PLAYER ===== */
const GROUND_Y=370, DRAW_W=54,DRAW_H=81,GRAV=0.5,JUMP_V=-9;
const keys={left:0,right:0,jump:0,punch:0};
const player={x:120,y:GROUND_Y-DRAW_H,vx:0,vy:0,facing:1,state:"idle",tick:0,airJumps:0};
const anims={idle:{frames:[0,1,2],speed:12},walk:{frames:[3,4,5],speed:8},punch:{frames:[6,7],speed:6},jump:{frames:[8],speed:12}};

/* ===== LEVELS ===== */
function door(x){ return {x,y:GROUND_Y-120,w:44,h:120}; }
const LEVELS=[
  {id:"room",name:"Room",music:"menu",bg:BG.room,doors:[door(14),door(742)],nextLeft:null,nextRight:"field"},
  {id:"field",name:"Field",music:"crane",bg:BG.field,doors:[door(14),door(742)],pit:{x:370,w:60},nextLeft:"room",nextRight:"crane"},
  {id:"crane",name:"Crane",music:"crane",bg:BG.crane,doors:[door(14),door(742)],nextLeft:"field",nextRight:"snake"},
  {id:"snake",name:"Snake",music:"snake",bg:BG.snake,doors:[door(14),door(742)],nextLeft:"crane",nextRight:"tiger"},
  {id:"tiger",name:"Tiger",music:"tiger",bg:BG.tiger,doors:[door(14),door(742)],nextLeft:"snake",nextRight:"templegates"},
  {id:"templegates",name:"Temple Gates",music:"gates",bg:BG.templegates,doors:[door(14),door(742)],nextLeft:"tiger",nextRight:"temple"},
  {id:"temple",name:"Temple",music:"temple",bg:BG.temple,doors:[door(14)],nextLeft:"room",nextRight:null}
];
let levelIndex=0,inGame=false;
const hud=document.getElementById("hud"),stageName=document.getElementById("stageName");

/* ===== GAME FLOW ===== */
function startGame(){ document.getElementById("menu").style.display="none"; cvs.style.display="block"; hud.style.display="block"; document.getElementById("controls").style.display="flex"; setLevel("room"); inGame=true; requestAnimationFrame(loop);}
function setLevel(id){ levelIndex=LEVELS.findIndex(L=>L.id===id); const L=LEVELS[levelIndex]; stageName.textContent=L.name; playMusic(L.music); player.x=120; player.y=GROUND_Y-DRAW_H; player.vx=player.vy=0; player.state="idle"; player.tick=0; player.airJumps=0; }

/* ===== LOOP ===== */
function loop(){ requestAnimationFrame(loop); if(!inGame)return; update(); render(); }
function update(){ const L=LEVELS[levelIndex]; player.vx=0; if(keys.left){player.vx=-2.6;player.facing=-1;} if(keys.right){player.vx=2.6;player.facing=1;}
  if(keys.jump){ if(player.y>=GROUND_Y-DRAW_H){player.vy=JUMP_V;player.airJumps=1;} else if(player.airJumps>0){player.vy=JUMP_V;player.airJumps=0;} keys.jump=0; }
  player.vy+=GRAV; player.x+=player.vx; player.y+=player.vy;
  if(player.x<0)player.x=0; if(player.x>cvs.width-DRAW_W)player.x=cvs.width-DRAW_W;
  let overPit=false; if(L.pit){const cx=player.x+DRAW_W/2;overPit=(cx>=L.pit.x&&cx<=L.pit.x+L.pit.w);}
  if(!overPit&&player.y>=GROUND_Y-DRAW_H){player.y=GROUND_Y-DRAW_H;player.vy=0;player.airJumps=1;}
  if(player.y>cvs.height+60){ setLevel(L.id); return; }
  if(player.vy<0||player.y<GROUND_Y-DRAW_H)player.state="jump"; else if(keys.punch)player.state="punch"; else if(player.vx)player.state="walk"; else player.state="idle";
  if(player.y>=GROUND_Y-DRAW_H-2){ for(const d of L.doors){ if(rectsOverlap(player.x,player.y,DRAW_W,DRAW_H,d.x,d.y,d.w,d.h)){ const goingRight=(player.x+DRAW_W/2)>cvs.width/2; const next=goingRight?L.nextRight:L.nextLeft; if(next){ setLevel(next); return; }}} }
  player.tick++;
}
function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){return ax<bx+bw&&ax+aw>bx&&ay<by+bh&&ay+ah>by;}
function render(){const L=LEVELS[levelIndex]; if(L.bg.complete)drawCover(L.bg,cvs.width,cvs.height); else{ctx.fillStyle="#0b1622";ctx.fillRect(0,0,cvs.width,cvs.height);} ctx.fillStyle="rgba(120,80,50,.88)";ctx.fillRect(30,GROUND_Y,cvs.width-60,18); if(L.pit){ctx.fillStyle="#081018";ctx.fillRect(L.pit.x,GROUND_Y,L.pit.w,999);} ctx.fillStyle="#7fb2a8";for(const d of L.doors){ctx.fillRect(d.x,d.y,d.w,d.h);ctx.strokeStyle="#9b6a3d";ctx.lineWidth=6;ctx.strokeRect(d.x+3,d.y+3,d.w-6,d.h-6);} if(spriteReady){const a=anims[player.state];const frame=a.frames[Math.floor(player.tick/a.speed)%a.frames.length];drawFrame(frame,Math.round(player.x),Math.round(player.y),player.facing<0);} }
function drawFrame(f,dx,dy,flip){const PAD=2,col=f%COLS,row=(f/COLS)|0;const sx=col*FW+PAD,sy=row*FH+PAD,sw=FW-PAD*2,sh=FH-PAD*2;ctx.save();if(flip){ctx.translate(dx+DRAW_W,dy);ctx.scale(-1,1);ctx.drawImage(sprite,sx,sy,sw,sh,0,0,DRAW_W,DRAW_H);}else{ctx.drawImage(sprite,sx,sy,sw,sh,dx,dy,DRAW_W,DRAW_H);}ctx.restore();}
addEventListener("keydown",e=>{if(e.key==="ArrowLeft"||e.key==="a")keys.left=1;if(e.key==="ArrowRight"||e.key==="d")keys.right=1;if(e.key===" "||e.key==="ArrowUp"||e.key==="w")keys.jump=1;if(e.key==="j"||e.key==="J")keys.punch=1;});
addEventListener("keyup",e=>{if(e.key==="ArrowLeft"||e.key==="a")keys.left=0;if(e.key==="ArrowRight"||e.key==="d")keys.right=0;if(e.key===" "||e.key==="ArrowUp"||e.key==="w")keys.jump=0;if(e.key==="j"||e.key==="J")keys.punch=0;});
</script>
</body>
</html>
